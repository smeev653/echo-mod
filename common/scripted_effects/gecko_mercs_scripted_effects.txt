#Country effect
gecko_mercs = {
	hidden_effect = {
		################################
		# Mercenary Force Limit
		################################
		
		#Matches country's land force limit to their mercenary force limit
		export_to_variable = {
			which = mercenary_forcelimit
			value = land_forcelimit
		}
		
		#Scalar for mercenary force limit
		divide_variable = {
			which = mercenary_forcelimit
			value = 4
		}
		
		#Smaller nations can receive a larger mercenary force limit
		if = {
			limit = { has_country_modifier = Minor }
			change_variable = {
				which = mercenary_forcelimit
				value = 5
			}
		}
		
		################################
		# Mercenary Force Limit Modifier
		################################
		
		#Converts mercenary_manpower modifier to mercenary force limit for this mercenary system
		export_to_variable = {
			which = mercenary_forcelimit_modifier
			value = modifier:mercenary_manpower 
		}
		
		#Sets limit of 90% mercenary force limit reduction
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = mercenary_forcelimit_modifier 
						value = -0.9
					}
				}
			}
			set_variable = {
				which = mercenary_forcelimit_modifier
				value = -0.9
			}
		}
		
		change_variable = {
			which = mercenary_forcelimit_modifier
			value = 1
		}
		
		multiply_variable = {
			which = mercenary_forcelimit
			which = mercenary_forcelimit_modifier
		}
		
		################################
		# Truncate Mercenary Force Limit
		################################
		set_variable = {
			which = mercenary_forcelimit_trucation
			which = mercenary_forcelimit
		}
		
		while = {
			limit = {
				check_variable = {
					which = mercenary_forcelimit_trucation
					value = 1
				}
			}
			
			subtract_variable = {
				which = mercenary_forcelimit_trucation
				value = 1
			}
		}
		
		subtract_variable = {
			which = mercenary_forcelimit
			which = mercenary_forcelimit_trucation
		}
		
		if = {
			limit = {
				is_variable_equal = {
					which = mercenary_forcelimit
					value = 0
				}
			}
			change_variable = {
				which = mercenary_forcelimit
				value = 1
			}
		}
		
		################################
		# Number of Owned Mercenaries
		################################
		
		#This value will include mercenary companies, used to compare force limit 
		export_to_variable = {
			which = number_of_owned_mercenaries
			value = trigger_value:num_of_mercenaries
		}
		
		#Tracks number of mercenaries available
		set_variable = {            
			which = mercenaries_available
			which = mercenary_forcelimit
		}
		
		subtract_variable = {            
			which = mercenaries_available
			which = number_of_owned_mercenaries
		}
		
		################################
		# Mercenary Cost
		################################
		
		#Base cost of mercenaries
		set_variable = {
			which = mercenary_cost
			value = 30
		}
		
		#Converts mercenary_cost modifier for this mercenary system
		export_to_variable = {
			variable_name = mercenary_cost_modifier
			value = modifier:mercenary_cost 
		}
		
		#Sets limit of 90% mercenary cost reduction
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = mercenary_cost_modifier 
						value = -0.9
					}
				}
			}
			set_variable = {
				which = mercenary_cost_modifier
				value = -0.9
			}
		}
		
		change_variable = {
			which = mercenary_cost_modifier
			value = 1
		}
		
		multiply_variable = {
			which = mercenary_cost
			which = mercenary_cost_modifier
		}
	}
}

#Country effect
gecko_mercs_army_professionalism_cost = {
	if = {
		limit = { has_free_mercs_trait = no }
		if = {
			limit = {
				OR = {
					has_country_flag = fifty_percent_merc_army_professionalism_cost 
					has_country_modifier = pol_cheap_ap_mercs_modifier
				}
			}
			add_army_professionalism = -0.001
		}
		else = {
			add_army_professionalism = -0.002
		}
	}
}

#Country effect
# <where> supports capital_scope and province_id
# <amount> recommendations: mercenaries_available, mercenary_forcelimit
recruit_gecko_mercs = {
	gecko_mercs = yes
	$where$ = { custom_tooltip = mercenary_recruitment_tt }
	[[variable]
		hidden_effect = {
			for_variable_amount = {
				variable = $amount$
				effect = "
					$where$ = { mercenary_infantry = PREV }
					gecko_mercs_army_professionalism_cost = yes
					set_variable = {
						which = mercenary_recruitment
						which = mercenary_cost
					}
					while = {
						limit = {
							check_variable = {
								which = mercenary_recruitment
								value = 0.001
							}
						}
						add_treasury = -0.001
						subtract_variable = {
							which = mercenary_recruitment
							value = 0.001
						}
					}
				"
			}
		}
	]
	[[fixed]
		hidden_effect = {
			if = {
				limit = {
					NOT = { 
						check_variable = {
							which = mercenaries_available
							value = $amount$
						}
					}
				}
				recruit_gecko_mercs = {
					variable = yes
					amount = mercenaries_available
					where = capital_scope
				}
			}
			else = {
				for = {
					amount = $amount$
					effect = "
						$where$ = { mercenary_infantry = PREV }
						gecko_mercs_army_professionalism_cost = yes
						set_variable = {
							which = mercenary_recruitment
							which = mercenary_cost
						}
						while = {
							limit = {
								check_variable = {
									which = mercenary_recruitment
									value = 0.001
								}
							}
							add_treasury = -0.001
							subtract_variable = {
								which = mercenary_recruitment
								value = 0.001
							}
						}
					"
				}
			}
		}
	]
}